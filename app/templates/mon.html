{% extends "base.html" %}
{% block content %}	
	<form>
	  <label><input type="radio" name="mode" value="size" checked> Size</label>
	  <label><input type="radio" name="mode" value="count"> Count</label>
	</form>

	<script>
		var margin = {top: 40, right: 10, bottom: 10, left: 10};
		var width = 2048 - margin.left - margin.right;
		var height = 1024 - margin.top - margin.bottom;

		var color = d3.scale.category20c();

		var treemap = d3.layout.treemap()
			.size([width, height])
			.sticky(true)
			.value(function(d) {return d.size;});

		var div = d3.select("body").append("div")
			.style("position", "relative")
			.style("width", (width + margin.left + margin.right) + "px")
			.style("height", (height + margin.top + margin.bottom) + "px")
			.style("left", margin.left + "px")
			.style("top", margin.top + "px");

		var mousemove = function(d) {
			var xPos = d3.event.pageX;
			var yPos = d3.event.pageY;

			d3.select("#tooltip")
			  .style("left", xPos + "px")
			  .style("top", yPos + "px");

			d3.select("#tooltip #pokemon").text(d["name"]);
			d3.select("#tooltip #encounters").text("# of Encounters: " + d["size"])

			d3.select("#tooltip").classed("hidden", false);
		};

		var mouseout = function() {
			d3.select("#tooltip").classed("hidden", true);
		};

		d3.json('https://s3.amazonaws.com/bas-d3-demo/mon_treemap.json', function(err, root) {
			if (err) throw err;

			var node = div.datum(root).selectAll(".node")
				.data(treemap.nodes)
			  .enter().append("div")
			  	.attr("class", "node")
			  	.call(position)
			  	.style("background", function(d) { return d.children ? color(d.name) : null; })
			  	.text(function(d) { return d.children ? null : d.name; })
			  	.on("mousemove", mousemove)
			  	.on("mouseout", mouseout);

			d3.selectAll("input").on("change", function change() {
				var value = this.value === "count" ? function() { return 1; } : function(d) { return d.size; };

				node.data(treemap.value(value).nodes)
				  .transition()
					.duration(1500)
					.call(position);
			});
		});

		function position() {
			this.style("left", function(d) { return d.x + "px"; })
				.style("top", function(d) { return d.y + "px"; })
				.style("width", function(d) { return Math.max(0, d.dx - 1) + "px"; })
				.style("height", function(d) { return Math.max(0, d.dy - 1) + "px"; });
		};
	</script>

	<div id="tooltip" class="hidden">
		<p><strong id="pokemon"></strong></p>
		<p><span id="encounters"></span></p>
	</div>

{% endblock %}